import{r as i,a as ee,d as j,j as s}from"./index-CMByewRX.js";import{m as O,j as se,t as te,T as ae,u as ne,h as _,v as ie}from"./firebase-ON2ZZD8i.js";import{c as re}from"./catalog-DPHdGcuj.js";import{s as le}from"./safeFetch-CUoSADqF.js";const W=[{value:"multiple_choice",label:"Multiple choice quiz"},{value:"reading_plus",label:"Reading plus text-dependent questions"},{value:"matching",label:"Matching definitions to concepts"}];function ge({user:u}){const p=i.useMemo(()=>re.subjects,[]),[d,Q]=i.useState(""),[h,N]=i.useState(""),[x,b]=i.useState(""),[v,S]=i.useState([]),[C,B]=i.useState(W[0].value),[A,U]=i.useState(5),[$,I]=i.useState(""),[w,k]=i.useState(""),[P,J]=i.useState(!0),[D,y]=i.useState(""),[T,L]=i.useState(!1),[M,q]=i.useState([]),{insights:o,summaries:z,records:G,groupInsights:g,pedagogy:c}=ee(),m=i.useMemo(()=>z[0]??null,[z]),f=i.useMemo(()=>{const e=G.filter(t=>typeof t.score=="number");return e.length?[...e].sort((t,n)=>{const r=t.score??0,l=n.score??0;return r-l}).slice(0,3).map(t=>`${t.displayName} (${t.score??"N/A"})`):[]},[G]),Y=i.useMemo(()=>{const e=[];if(m?.testName){const n=m.averageScore!==null?`averaged ${m.averageScore.toFixed(1)}`:"is awaiting average calculations";e.push(`Latest assessment ${m.testName} ${n}.`)}o?.highest?.name&&o.highest.score!==null&&e.push(`${o.highest.name} is excelling at ${o.highest.score}.`),f.length&&e.push(`Learners needing support: ${f.join(", ")}.`),c?.summary&&e.push(c.summary);const a=g.find(n=>n.id==="foundation");a&&e.push(`Design scaffolds with student voice for ${a.studentCount} learners in the ${a.label.toLowerCase()} group.`);const t=g.find(n=>n.id==="extending");return t&&e.push(`Activate ${t.studentCount} ${t.label.toLowerCase()} learners as peer mentors and co-designers.`),e.length||e.push("Use evidence-based instructional strategies connected to recent mastery trends."),e.join(" ")},[o,m,f,c,g]),R=i.useMemo(()=>{if(!o||!m)return"Upload mastery rosters so the AI can anchor prompts to real class data.";const e=[];if(e.push(`Latest: ${m.testName}${m.averageScore!==null?` · Avg ${m.averageScore.toFixed(1)}`:""}`),o.highest?.name&&o.highest.score!==null&&e.push(`Top: ${o.highest.name} ${o.highest.score}`),f.length&&e.push(`Needs support: ${f.join(", ")}`),g.length){const a=g.map(t=>`${t.label.replace(/\s+/g," ")} ${t.range}`).join(" • ");e.push(`Groups: ${a}`)}return e.join(" • ")},[o,m,f,g]),H=i.useMemo(()=>({pedagogy:c?{summary:c.summary,bestPractices:c.bestPractices,reflectionPrompts:c.reflectionPrompts}:null,groups:g.map(e=>({id:e.id,label:e.label,range:e.range,studentCount:e.studentCount,recommendedPractices:e.recommendedPractices,studentNames:e.students.map(a=>a.name)}))}),[g,c]),E=i.useMemo(()=>{if(!p.length)return[];if(d){const a=p.find(t=>t.id===d);return Object.keys(a?.grades??{}).sort((t,n)=>Number(t)-Number(n))}const e=new Set;return p.forEach(a=>{Object.keys(a.grades??{}).forEach(t=>e.add(t))}),Array.from(e).sort((a,t)=>Number(a)-Number(t))},[d,p]);i.useEffect(()=>{if(!d||!h){S([]),b("");return}const e=p.find(t=>t.id===d);if(!e?.grades?.[h]){S([]),b(""),N("");return}const a=e.grades[h]?.standards??[];S(a),a.some(t=>t.code===x)||b(a[0]?.code??"")},[d,h,p,x]),i.useEffect(()=>{if(!u){q([]);return}const e=O(j,`users/${u.uid}/assignments`),a=se(e,t=>{const n=[];t.forEach(r=>{const l=r.data();n.push({id:r.id,title:l.title??"AI assignment",status:l.status??"draft",dueDate:l.dueDate,blueprint:l.blueprint,createdAt:l.createdAt?.toDate?.()?.toISOString?.()??null})}),q(n)});return()=>a()},[u]);async function K(e){if(e.preventDefault(),!u)return;if(!d||!h||!x){y("Complete the subject, grade, and standard selections.");return}if(!$.trim()){y("Provide a title so the assignment is easy to find later.");return}const a=p.find(n=>n.id===d)?.label??d,t=v.find(n=>n.code===x);try{L(!0),y("Generating AI assessment…");const n=await le("/.netlify/functions/generateAssignment",{method:"POST",body:JSON.stringify({standardCode:x,standardName:t?.name??x,focus:Y,subject:a,grade:h,assessmentType:C,questionCount:A,includeRemediation:P,classContext:H})});await te(O(j,`users/${u.uid}/assignments`),{title:$,status:"draft",dueDate:w||null,createdAt:ae.now(),blueprint:n,standardCode:n.standardCode,assessmentType:n.assessmentType,questionCount:n.questionCount}),y("Assignment generated and saved securely."),I(""),k("")}catch(n){console.error(n),y(n?.message??"Assignment generation failed.")}finally{L(!1)}}async function F(e,a){u&&(await ne(_(j,`users/${u.uid}/assignments/${e}`),{status:a}),y("Status updated."))}async function V(e){u&&(await ie(_(j,`users/${u.uid}/assignments/${e}`)),y("Assignment deleted."))}function X(e){if(!e.blueprint){window.print();return}const a=window.open("","_blank");if(!a)return;const t=e.blueprint,n=`<!doctype html>
      <html>
        <head>
          <meta charset="utf-8" />
          <title>${e.title}</title>
          <style>
            body { font-family: 'Inter', sans-serif; padding: 32px; color: #0f172a; }
            h1 { font-size: 24px; margin-bottom: 8px; }
            h2 { font-size: 18px; margin-top: 24px; }
            ul { margin: 0 0 16px 20px; }
            .question { border: 1px solid #cbd5f5; padding: 12px; border-radius: 12px; margin-bottom: 12px; }
          </style>
        </head>
        <body>
          <h1>${e.title}</h1>
          <p><strong>Standard:</strong> ${t.standardCode} — ${t.standardName}</p>
          <p><strong>Assessment type:</strong> ${t.assessmentType.replace(/_/g," ")}</p>
          <p><strong>Questions:</strong> ${t.questionCount}</p>
          <h2>AI overview</h2>
          <p>${t.aiInsights.overview}</p>
          <h2>Class strategies</h2>
          <ul>${t.aiInsights.classStrategies.map(r=>`<li>${r}</li>`).join("")}</ul>
          <h2>Next steps</h2>
          <ul>${t.aiInsights.nextSteps.map(r=>`<li>${r}</li>`).join("")}</ul>
          ${t.aiInsights.pedagogy?`<h2>Pedagogical focus</h2>
               <p>${t.aiInsights.pedagogy.summary}</p>
               <ul>${t.aiInsights.pedagogy.bestPractices.map(r=>`<li>${r}</li>`).join("")}</ul>
               <h3>Reflection prompts</h3>
               <ul>${t.aiInsights.pedagogy.reflectionPrompts.map(r=>`<li>${r}</li>`).join("")}</ul>`:""}
          ${t.levels.map(r=>`
                <section>
                  <h2>${r.level}</h2>
                  <p>${r.description}</p>
                  ${r.questions.map(l=>`
                        <div class="question">
                          <strong>Prompt:</strong> ${l.prompt}
                          ${l.options?`<ol>${l.options.map(Z=>`<li>${Z}</li>`).join("")}</ol>`:""}
                          <p><strong>Answer:</strong> ${l.answer}</p>
                          <p><em>${l.rationale}</em></p>
                        </div>
                      `).join("")}
                  ${r.remediation.length?`<h3>Remediation</h3><ul>${r.remediation.map(l=>`<li>${l}</li>`).join("")}</ul>`:""}
                </section>
              `).join("")}
        </body>
      </html>`;a.document.write(n),a.document.close(),a.focus(),a.print()}return u?s.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("div",{className:"badge",children:"AI assignment builder"}),s.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Generate standards-aligned assessments"}),R&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(99,102,241,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14},children:[s.jsx("strong",{style:{display:"block",marginBottom:6,color:"#cbd5f5",letterSpacing:.3},children:"Linked mastery insight"}),R]}),c&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14,display:"grid",gap:10},children:[s.jsx("strong",{style:{display:"block",color:"#cbd5f5",letterSpacing:.3},children:"Pedagogical commitments"}),s.jsx("p",{style:{margin:0},children:c.summary}),s.jsx("ul",{style:{margin:0,paddingLeft:18,display:"grid",gap:6},children:c.bestPractices.map((e,a)=>s.jsx("li",{children:e},a))})]}),g.length>0&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14,display:"grid",gap:12},children:[s.jsx("strong",{style:{display:"block",color:"#cbd5f5",letterSpacing:.3},children:"Suggested learning groups"}),s.jsx("div",{style:{display:"grid",gap:10},children:g.map(e=>s.jsxs("div",{style:{display:"grid",gap:6},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",gap:12},children:[s.jsx("span",{style:{fontWeight:600,color:"#e0e7ff"},children:e.label}),s.jsxs("span",{style:{fontSize:13},children:[e.range," • ",e.studentCount," ",e.studentCount===1?"learner":"learners"]})]}),e.students.length>0&&s.jsxs("span",{style:{fontSize:13},children:["Learners: ",e.students.map(a=>a.name).join(", ")]}),s.jsx("ul",{style:{margin:0,paddingLeft:18,display:"grid",gap:4},children:e.recommendedPractices.map((a,t)=>s.jsx("li",{children:a},t))})]},e.id))})]}),s.jsxs("form",{onSubmit:K,style:{display:"grid",gap:16},children:[s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-title",children:"Assignment title"}),s.jsx("input",{id:"assignment-title",name:"assignment-title",value:$,onChange:e=>I(e.target.value),placeholder:"e.g., Expressions mastery checkpoint",required:!0})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-subject",children:"Subject"}),s.jsxs("select",{id:"assignment-subject",name:"assignment-subject",value:d,onChange:e=>Q(e.target.value),children:[s.jsx("option",{value:"",children:"Select a subject"}),p.map(e=>s.jsx("option",{value:e.id,children:e.label},e.id))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-grade",children:"Grade level"}),s.jsxs("select",{id:"assignment-grade",name:"assignment-grade",value:h,onChange:e=>N(e.target.value),disabled:!d||E.length===0,children:[s.jsx("option",{value:"",children:d?"Select a grade level":"Select a subject first"}),E.map(e=>s.jsxs("option",{value:e,children:["Grade ",e]},e))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-standard",children:"Standard"}),s.jsxs("select",{id:"assignment-standard",name:"assignment-standard",value:x,onChange:e=>b(e.target.value),disabled:!h||v.length===0,children:[s.jsx("option",{value:"",children:"Select a standard"}),v.map(e=>s.jsxs("option",{value:e.code,children:[e.code," — ",e.name]},e.code))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-type",children:"Assessment type"}),s.jsx("select",{id:"assignment-type",name:"assignment-type",value:C,onChange:e=>B(e.target.value),children:W.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-questions",children:"Question count"}),s.jsx("select",{id:"assignment-questions",name:"assignment-questions",value:A,onChange:e=>U(Number(e.target.value)),children:[5,10,15].map(e=>s.jsxs("option",{value:e,children:[e," questions"]},e))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-due",children:"Due date"}),s.jsx("input",{id:"assignment-due",name:"assignment-due",type:"date",value:w,onChange:e=>k(e.target.value)})]}),s.jsxs("div",{className:"field",style:{display:"flex",alignItems:"center",gap:12},children:[s.jsx("input",{id:"assignment-remediation",name:"assignment-remediation",type:"checkbox",checked:P,onChange:e=>J(e.target.checked)}),s.jsx("label",{htmlFor:"assignment-remediation",style:{cursor:"pointer"},children:"Include remediation pathways"})]}),s.jsx("button",{type:"submit",className:"primary",disabled:T,children:T?"Generating…":"Generate and save assignment"})]}),D&&s.jsx("p",{style:{marginTop:8,color:"var(--text-muted)"},children:D})]}),s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:24,fontWeight:700},children:"Assignments library"}),s.jsx("p",{style:{color:"var(--text-muted)",marginTop:4},children:"Print, remediate, or assign at any time."})]})}),M.length===0?s.jsx("div",{className:"empty-state",children:"Generate an assignment to populate this library."}):s.jsx("div",{style:{display:"grid",gap:16},children:M.map(e=>s.jsxs("article",{className:"glass-subcard",style:{border:"1px solid rgba(148,163,184,0.25)",borderRadius:18,padding:18,background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[s.jsxs("div",{children:[s.jsx("h4",{style:{margin:0,fontSize:20},children:e.title}),e.blueprint&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:[e.blueprint.standardCode," · ",e.blueprint.assessmentType.replace(/_/g," ")," · ",e.blueprint.questionCount," questions"]}),e.dueDate&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:["Due ",new Date(e.dueDate).toLocaleDateString()]})]}),s.jsx("span",{className:"tag",style:{textTransform:"capitalize"},children:e.status})]}),e.blueprint&&s.jsxs("div",{style:{display:"grid",gap:12},children:[s.jsxs("div",{children:[s.jsx("strong",{children:"AI insights"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.classStrategies.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Remediation"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.levels.flatMap(a=>a.remediation).slice(0,3).map((a,t)=>s.jsx("li",{children:a},t))})]}),e.blueprint.aiInsights.pedagogy&&s.jsxs("div",{children:[s.jsx("strong",{children:"Pedagogical focus"}),s.jsx("p",{style:{margin:"8px 0 0",color:"var(--text-muted)"},children:e.blueprint.aiInsights.pedagogy.summary}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.pedagogy.bestPractices.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[s.jsx("button",{className:"secondary",onClick:()=>F(e.id,"assigned"),children:"Mark assigned"}),s.jsx("button",{className:"secondary",onClick:()=>F(e.id,"completed"),children:"Mark complete"}),s.jsx("button",{className:"secondary",onClick:()=>X(e),children:"Print"}),s.jsx("button",{className:"secondary",onClick:()=>V(e.id),children:"Delete"})]})]},e.id))})]})]}):s.jsxs("div",{className:"glass-card fade-in",children:[s.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Authenticate to manage assignments"}),s.jsx("p",{style:{color:"var(--text-muted)"},children:"Assignments and AI blueprints are saved privately to your workspace. No student data leaves your secured scope."})]})}export{ge as default};
