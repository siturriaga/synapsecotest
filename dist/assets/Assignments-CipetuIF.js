import{r as i,u as ee,d as b,j as s}from"./index-Babasj67.js";import{r as E,j as se,w as te,T as ae,x as ne,h as _,u as ie}from"./firebase-BnXfUrx6.js";import{c as le}from"./catalog-hwBwqGgt.js";import{s as re}from"./safeFetch-BFwNDYL7.js";import{A as N}from"./AssistedHint-QoWDV7PM.js";const W=[{value:"multiple_choice",label:"Multiple choice quiz"},{value:"reading_plus",label:"Reading plus text-dependent questions"},{value:"matching",label:"Matching definitions to concepts"}];function pe({user:c}){const j=i.useMemo(()=>le.subjects,[]),[u,B]=i.useState(""),[h,O]=i.useState(""),[m,f]=i.useState(""),[v,A]=i.useState([]),[w,Q]=i.useState(W[0].value),[I,U]=i.useState(5),[S,k]=i.useState(""),[P,D]=i.useState(""),[T,H]=i.useState(!0),[L,x]=i.useState(""),[$,q]=i.useState(!1),[C,M]=i.useState([]),{insights:d,summaries:z,records:G,groupInsights:g,pedagogy:o}=ee(),p=i.useMemo(()=>z[0]??null,[z]),y=i.useMemo(()=>{const e=G.filter(t=>typeof t.score=="number");return e.length?[...e].sort((t,n)=>{const l=t.score??0,r=n.score??0;return l-r}).slice(0,3).map(t=>`${t.displayName} (${t.score??"—"})`):[]},[G]),J=i.useMemo(()=>{const e=[];if(p?.testName){const n=p.averageScore!==null?`averaged ${p.averageScore.toFixed(1)}`:"is awaiting average calculations";e.push(`Latest assessment ${p.testName} ${n}.`)}d?.highest?.name&&d.highest.score!==null&&e.push(`${d.highest.name} is excelling at ${d.highest.score}.`),y.length&&e.push(`Learners needing support: ${y.join(", ")}.`),o?.summary&&e.push(o.summary);const a=g.find(n=>n.id==="foundation");a&&e.push(`Design scaffolds with student voice for ${a.studentCount} learners in the ${a.label.toLowerCase()} group.`);const t=g.find(n=>n.id==="extending");return t&&e.push(`Activate ${t.studentCount} ${t.label.toLowerCase()} learners as peer mentors and co-designers.`),e.length||e.push("Use evidence-based instructional strategies connected to recent mastery trends."),e.join(" ")},[d,p,y,o,g]),R=i.useMemo(()=>{if(!d||!p)return"Upload mastery rosters so the AI can anchor prompts to real class data.";const e=[];if(e.push(`Latest: ${p.testName}${p.averageScore!==null?` · Avg ${p.averageScore.toFixed(1)}`:""}`),d.highest?.name&&d.highest.score!==null&&e.push(`Top: ${d.highest.name} ${d.highest.score}`),y.length&&e.push(`Needs support: ${y.join(", ")}`),g.length){const a=g.map(t=>`${t.label.replace(/\s+/g," ")} ${t.range}`).join(" • ");e.push(`Groups: ${a}`)}return e.join(" • ")},[d,p,y,g]),Y=i.useMemo(()=>({pedagogy:o?{summary:o.summary,bestPractices:o.bestPractices,reflectionPrompts:o.reflectionPrompts}:null,groups:g.map(e=>({id:e.id,label:e.label,range:e.range,studentCount:e.studentCount,recommendedPractices:e.recommendedPractices,studentNames:e.students.map(a=>a.name)}))}),[g,o]);i.useEffect(()=>{if(!u||!h){A([]),f("");return}const a=j.find(t=>t.id===u)?.grades?.[h]?.standards??[];A(a),a.some(t=>t.code===m)||f(a[0]?.code??"")},[u,h,j,m]),i.useEffect(()=>{if(!c){M([]);return}const e=E(b,`users/${c.uid}/assignments`),a=se(e,t=>{const n=[];t.forEach(l=>{const r=l.data();n.push({id:l.id,title:r.title??"AI assignment",status:r.status??"draft",dueDate:r.dueDate,blueprint:r.blueprint,createdAt:r.createdAt?.toDate?.()?.toISOString?.()??null})}),M(n)});return()=>a()},[c]);async function K(e){if(e.preventDefault(),!c)return;if(!u||!h||!m){x("Complete the subject, grade, and standard selections.");return}if(!S.trim()){x("Provide a title so the assignment is easy to find later.");return}const a=j.find(n=>n.id===u)?.label??u,t=v.find(n=>n.code===m);try{q(!0),x("Generating AI assessment…");const n=await re("/.netlify/functions/generateAssignment",{method:"POST",body:JSON.stringify({standardCode:m,standardName:t?.name??m,focus:J,subject:a,grade:h,assessmentType:w,questionCount:I,includeRemediation:T,classContext:Y})});await te(E(b,`users/${c.uid}/assignments`),{title:S,status:"draft",dueDate:P||null,createdAt:ae.now(),blueprint:n,standardCode:n.standardCode,assessmentType:n.assessmentType,questionCount:n.questionCount}),x("Assignment generated and saved securely."),k(""),D("")}catch(n){console.error(n),x(n?.message??"Assignment generation failed.")}finally{q(!1)}}async function F(e,a){c&&(await ne(_(b,`users/${c.uid}/assignments/${e}`),{status:a}),x("Status updated."))}async function V(e){c&&(await ie(_(b,`users/${c.uid}/assignments/${e}`)),x("Assignment deleted."))}function X(e){if(!e.blueprint){window.print();return}const a=window.open("","_blank");if(!a)return;const t=e.blueprint,n=`<!doctype html>
      <html>
        <head>
          <meta charset="utf-8" />
          <title>${e.title}</title>
          <style>
            body { font-family: 'Inter', sans-serif; padding: 32px; color: #0f172a; }
            h1 { font-size: 24px; margin-bottom: 8px; }
            h2 { font-size: 18px; margin-top: 24px; }
            ul { margin: 0 0 16px 20px; }
            .question { border: 1px solid #cbd5f5; padding: 12px; border-radius: 12px; margin-bottom: 12px; }
          </style>
        </head>
        <body>
          <h1>${e.title}</h1>
          <p><strong>Standard:</strong> ${t.standardCode} — ${t.standardName}</p>
          <p><strong>Assessment type:</strong> ${t.assessmentType.replace(/_/g," ")}</p>
          <p><strong>Questions:</strong> ${t.questionCount}</p>
          <h2>AI overview</h2>
          <p>${t.aiInsights.overview}</p>
          <h2>Class strategies</h2>
          <ul>${t.aiInsights.classStrategies.map(l=>`<li>${l}</li>`).join("")}</ul>
          <h2>Next steps</h2>
          <ul>${t.aiInsights.nextSteps.map(l=>`<li>${l}</li>`).join("")}</ul>
          ${t.aiInsights.pedagogy?`<h2>Pedagogical focus</h2>
               <p>${t.aiInsights.pedagogy.summary}</p>
               <ul>${t.aiInsights.pedagogy.bestPractices.map(l=>`<li>${l}</li>`).join("")}</ul>
               <h3>Reflection prompts</h3>
               <ul>${t.aiInsights.pedagogy.reflectionPrompts.map(l=>`<li>${l}</li>`).join("")}</ul>`:""}
          ${t.levels.map(l=>`
                <section>
                  <h2>${l.level}</h2>
                  <p>${l.description}</p>
                  ${l.questions.map(r=>`
                        <div class="question">
                          <strong>Prompt:</strong> ${r.prompt}
                          ${r.options?`<ol>${r.options.map(Z=>`<li>${Z}</li>`).join("")}</ol>`:""}
                          <p><strong>Answer:</strong> ${r.answer}</p>
                          <p><em>${r.rationale}</em></p>
                        </div>
                      `).join("")}
                  ${l.remediation.length?`<h3>Remediation</h3><ul>${l.remediation.map(r=>`<li>${r}</li>`).join("")}</ul>`:""}
                </section>
              `).join("")}
        </body>
      </html>`;a.document.write(n),a.document.close(),a.focus(),a.print()}return c?s.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("div",{className:"badge",children:"AI assignment builder"}),s.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Generate standards-aligned assessments"}),R&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(99,102,241,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14},children:[s.jsx("strong",{style:{display:"block",marginBottom:6,color:"#cbd5f5",letterSpacing:.3},children:"Linked mastery insight"}),R]}),o&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14,display:"grid",gap:10},children:[s.jsx("strong",{style:{display:"block",color:"#cbd5f5",letterSpacing:.3},children:"Pedagogical commitments"}),s.jsx("p",{style:{margin:0},children:o.summary}),s.jsx("ul",{style:{margin:0,paddingLeft:18,display:"grid",gap:6},children:o.bestPractices.map((e,a)=>s.jsx("li",{children:e},a))})]}),g.length>0&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14,display:"grid",gap:12},children:[s.jsx("strong",{style:{display:"block",color:"#cbd5f5",letterSpacing:.3},children:"Suggested learning groups"}),s.jsx("div",{style:{display:"grid",gap:10},children:g.map(e=>s.jsxs("div",{style:{display:"grid",gap:6},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",gap:12},children:[s.jsx("span",{style:{fontWeight:600,color:"#e0e7ff"},children:e.label}),s.jsxs("span",{style:{fontSize:13},children:[e.range," • ",e.studentCount," ",e.studentCount===1?"learner":"learners"]})]}),e.students.length>0&&s.jsxs("span",{style:{fontSize:13},children:["Learners: ",e.students.map(a=>a.name).join(", ")]}),s.jsx("ul",{style:{margin:0,paddingLeft:18,display:"grid",gap:4},children:e.recommendedPractices.map((a,t)=>s.jsx("li",{children:a},t))})]},e.id))})]}),s.jsxs("form",{onSubmit:K,style:{display:"grid",gap:16},children:[s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-title",children:"Assignment title"}),s.jsx("input",{id:"assignment-title",name:"assignment-title",value:S,onChange:e=>k(e.target.value),placeholder:"e.g., Expressions mastery checkpoint",required:!0})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-subject",children:"Subject"}),s.jsxs("select",{id:"assignment-subject",name:"assignment-subject",value:u,onChange:e=>B(e.target.value),children:[s.jsx("option",{value:"",children:"Select a subject"}),j.map(e=>s.jsx("option",{value:e.id,children:e.label},e.id))]})]}),s.jsx(N,{id:"assignment-pick-subject",message:"Choose the subject you teach to unlock the matching grade bands and standards.",show:!u}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-grade",children:"Grade level"}),s.jsxs("select",{id:"assignment-grade",name:"assignment-grade",value:h,onChange:e=>O(e.target.value),disabled:!u,children:[s.jsx("option",{value:"",children:"Select grade 6, 7, or 8"}),["6","7","8"].map(e=>s.jsxs("option",{value:e,children:["Grade ",e]},e))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-standard",children:"Standard"}),s.jsxs("select",{id:"assignment-standard",name:"assignment-standard",value:m,onChange:e=>f(e.target.value),disabled:!h||v.length===0,children:[s.jsx("option",{value:"",children:"Select a standard"}),v.map(e=>s.jsxs("option",{value:e.code,children:[e.code," — ",e.name]},e.code))]})]}),s.jsx(N,{id:"assignment-select-standard",message:"After selecting subject and grade, pick the exact standard so Synapse can craft a targeted assessment.",show:!!(u&&h&&!m)}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-type",children:"Assessment type"}),s.jsx("select",{id:"assignment-type",name:"assignment-type",value:w,onChange:e=>Q(e.target.value),children:W.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-questions",children:"Question count"}),s.jsx("select",{id:"assignment-questions",name:"assignment-questions",value:I,onChange:e=>U(Number(e.target.value)),children:[5,10,15].map(e=>s.jsxs("option",{value:e,children:[e," questions"]},e))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-due",children:"Due date"}),s.jsx("input",{id:"assignment-due",name:"assignment-due",type:"date",value:P,onChange:e=>D(e.target.value)})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:12},children:[s.jsx("input",{type:"checkbox",checked:T,onChange:e=>H(e.target.checked)}),"Include remediation pathways"]}),s.jsx("button",{type:"submit",className:"primary",disabled:$,children:$?"Generating…":"Generate and save assignment"}),s.jsx(N,{id:"assignment-generate",message:"Click Generate once the standard and question count look right — Synapse will save the AI plan automatically.",show:!$&&!!m&&C.length===0})]}),L&&s.jsx("p",{style:{marginTop:8,color:"var(--text-muted)"},children:L})]}),s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:24,fontWeight:700},children:"Assignments library"}),s.jsx("p",{style:{color:"var(--text-muted)",marginTop:4},children:"Print, remediate, or assign at any time."})]})}),C.length===0?s.jsx("div",{className:"empty-state",children:"Generate an assignment to populate this library."}):s.jsx("div",{style:{display:"grid",gap:16},children:C.map(e=>s.jsxs("article",{className:"glass-subcard",style:{border:"1px solid rgba(148,163,184,0.25)",borderRadius:18,padding:18,background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[s.jsxs("div",{children:[s.jsx("h4",{style:{margin:0,fontSize:20},children:e.title}),e.blueprint&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:[e.blueprint.standardCode," · ",e.blueprint.assessmentType.replace(/_/g," ")," · ",e.blueprint.questionCount," questions"]}),e.dueDate&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:["Due ",new Date(e.dueDate).toLocaleDateString()]})]}),s.jsx("span",{className:"tag",style:{textTransform:"capitalize"},children:e.status})]}),e.blueprint&&s.jsxs("div",{style:{display:"grid",gap:12},children:[s.jsxs("div",{children:[s.jsx("strong",{children:"AI insights"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.classStrategies.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Remediation"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.levels.flatMap(a=>a.remediation).slice(0,3).map((a,t)=>s.jsx("li",{children:a},t))})]}),e.blueprint.aiInsights.pedagogy&&s.jsxs("div",{children:[s.jsx("strong",{children:"Pedagogical focus"}),s.jsx("p",{style:{margin:"8px 0 0",color:"var(--text-muted)"},children:e.blueprint.aiInsights.pedagogy.summary}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.pedagogy.bestPractices.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[s.jsx("button",{className:"secondary",onClick:()=>F(e.id,"assigned"),children:"Mark assigned"}),s.jsx("button",{className:"secondary",onClick:()=>F(e.id,"completed"),children:"Mark complete"}),s.jsx("button",{className:"secondary",onClick:()=>X(e),children:"Print"}),s.jsx("button",{className:"secondary",onClick:()=>V(e.id),children:"Delete"})]})]},e.id))})]})]}):s.jsxs("div",{className:"glass-card fade-in",children:[s.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Authenticate to manage assignments"}),s.jsx("p",{style:{color:"var(--text-muted)"},children:"Assignments and AI blueprints are saved privately to your workspace. No student data leaves your secured scope."})]})}export{pe as default};
