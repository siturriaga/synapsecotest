import{b as y}from"./index-UOQmTZJ0.js";const E={},p="/.netlify/functions/",_="/api/",I="http://localhost:8888",F=(E?.VITE_FUNCTION_BASE_URL||"https://synapsecopilot.com").replace(/\/$/,"");class d extends Error{constructor(n,t){super(n),this.status=t}}async function T(e,n){const t=new Headers(e.headers??{});return typeof e.body=="string"&&!t.has("Content-Type")&&t.set("Content-Type","application/json"),t.set("Accept","application/json"),n&&t.set("Authorization",`Bearer ${n}`),t}async function g(e,n,t){const r=await T(n,t);return fetch(e,{...n,headers:r})}async function R(e){const n=await e.text();try{const t=JSON.parse(n);if(t&&typeof t.error=="string")return t.error}catch{}return n||`Request failed with status ${e.status}`}async function x(e,n={}){const t=await y.currentUser?.getIdToken?.(),r=[],a=o=>{r.includes(o)||r.push(o)};a(e);const h=e.startsWith(p),w=typeof window<"u"&&typeof window.location<"u";h&&(a(`${_}${e.slice(p.length)}`),w&&window.location.hostname==="localhost"&&a(`${I}${e}`),a(`${F}${e}`));let c;const u=(o,f)=>h&&o instanceof d&&o.status===404&&f<r.length-1;for(let o=0;o<r.length;o+=1){const f=r[o];try{const s=await g(f,n,t);if(!s.ok){const i=new d(await R(s),s.status);if(c=i,u(i,o))continue;throw i}const l=s.clone();try{return await s.json()}catch{return await l.text()}}catch(s){if(c=s,u(s,o))continue;throw s instanceof Error?s:new Error("Request failed")}}throw c instanceof Error?c:new Error("Request failed")}export{x as s};
