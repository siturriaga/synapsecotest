import{r as n,u as K,d as j,j as s}from"./index-BdaUekzB.js";import{j as E,k as V,t as X,T as Z,u as ee,m as R,v as se}from"./firebase-DMftn6xT.js";import{c as te}from"./catalog-hwBwqGgt.js";import{s as ae}from"./safeFetch-CLicF8cn.js";const G=[{value:"multiple_choice",label:"Multiple choice quiz"},{value:"reading_plus",label:"Reading plus text-dependent questions"},{value:"matching",label:"Matching definitions to concepts"}];function de({user:c}){const x=n.useMemo(()=>te.subjects,[]),[u,P]=n.useState(""),[m,_]=n.useState(""),[p,f]=n.useState(""),[y,v]=n.useState([]),[S,W]=n.useState(G[0].value),[$,O]=n.useState(5),[b,N]=n.useState(""),[A,C]=n.useState(""),[w,Q]=n.useState(!0),[I,g]=n.useState(""),[T,D]=n.useState(!1),[k,q]=n.useState([]),{insights:d,summaries:M,records:F}=K(),o=n.useMemo(()=>M[0]??null,[M]),h=n.useMemo(()=>{const e=F.filter(t=>typeof t.score=="number");return e.length?[...e].sort((t,i)=>{const l=t.score??0,r=i.score??0;return l-r}).slice(0,3).map(t=>`${t.displayName} (${t.score??"—"})`):[]},[F]),B=n.useMemo(()=>{if(!d||!o)return"Use evidence-based instructional strategies connected to recent mastery trends.";const e=[];if(o.testName){const a=o.averageScore!==null?`averaged ${o.averageScore.toFixed(1)}`:"is awaiting average calculations";e.push(`Latest assessment ${o.testName} ${a}.`)}return d.highest?.name&&d.highest.score!==null&&e.push(`${d.highest.name} is excelling at ${d.highest.score}.`),h.length&&e.push(`Learners needing support: ${h.join(", ")}.`),e.join(" ")},[d,o,h]),L=n.useMemo(()=>{if(!d||!o)return"Upload mastery rosters so the AI can anchor prompts to real class data.";const e=[];return e.push(`Latest: ${o.testName}${o.averageScore!==null?` · Avg ${o.averageScore.toFixed(1)}`:""}`),d.highest?.name&&d.highest.score!==null&&e.push(`Top: ${d.highest.name} ${d.highest.score}`),h.length&&e.push(`Needs support: ${h.join(", ")}`),e.join(" • ")},[d,o,h]);n.useEffect(()=>{if(!u||!m){v([]),f("");return}const a=x.find(t=>t.id===u)?.grades?.[m]?.standards??[];v(a),a.some(t=>t.code===p)||f(a[0]?.code??"")},[u,m,x,p]),n.useEffect(()=>{if(!c){q([]);return}const e=E(j,`users/${c.uid}/assignments`),a=V(e,t=>{const i=[];t.forEach(l=>{const r=l.data();i.push({id:l.id,title:r.title??"AI assignment",status:r.status??"draft",dueDate:r.dueDate,blueprint:r.blueprint,createdAt:r.createdAt?.toDate?.()?.toISOString?.()??null})}),q(i)});return()=>a()},[c]);async function U(e){if(e.preventDefault(),!c)return;if(!u||!m||!p){g("Complete the subject, grade, and standard selections.");return}if(!b.trim()){g("Provide a title so the assignment is easy to find later.");return}const a=x.find(i=>i.id===u)?.label??u,t=y.find(i=>i.code===p);try{D(!0),g("Generating AI assessment…");const i=await ae("/.netlify/functions/generateAssignment",{method:"POST",body:JSON.stringify({standardCode:p,standardName:t?.name??p,focus:B,subject:a,grade:m,assessmentType:S,questionCount:$,includeRemediation:w})});await X(E(j,`users/${c.uid}/assignments`),{title:b,status:"draft",dueDate:A||null,createdAt:Z.now(),blueprint:i,standardCode:i.standardCode,assessmentType:i.assessmentType,questionCount:i.questionCount}),g("Assignment generated and saved securely."),N(""),C("")}catch(i){console.error(i),g(i?.message??"Assignment generation failed.")}finally{D(!1)}}async function z(e,a){c&&(await ee(R(j,`users/${c.uid}/assignments/${e}`),{status:a}),g("Status updated."))}async function J(e){c&&(await se(R(j,`users/${c.uid}/assignments/${e}`)),g("Assignment deleted."))}function Y(e){if(!e.blueprint){window.print();return}const a=window.open("","_blank");if(!a)return;const t=e.blueprint,i=`<!doctype html>
      <html>
        <head>
          <meta charset="utf-8" />
          <title>${e.title}</title>
          <style>
            body { font-family: 'Inter', sans-serif; padding: 32px; color: #0f172a; }
            h1 { font-size: 24px; margin-bottom: 8px; }
            h2 { font-size: 18px; margin-top: 24px; }
            ul { margin: 0 0 16px 20px; }
            .question { border: 1px solid #cbd5f5; padding: 12px; border-radius: 12px; margin-bottom: 12px; }
          </style>
        </head>
        <body>
          <h1>${e.title}</h1>
          <p><strong>Standard:</strong> ${t.standardCode} — ${t.standardName}</p>
          <p><strong>Assessment type:</strong> ${t.assessmentType.replace(/_/g," ")}</p>
          <p><strong>Questions:</strong> ${t.questionCount}</p>
          <h2>AI overview</h2>
          <p>${t.aiInsights.overview}</p>
          <h2>Class strategies</h2>
          <ul>${t.aiInsights.classStrategies.map(l=>`<li>${l}</li>`).join("")}</ul>
          <h2>Next steps</h2>
          <ul>${t.aiInsights.nextSteps.map(l=>`<li>${l}</li>`).join("")}</ul>
          ${t.levels.map(l=>`
                <section>
                  <h2>${l.level}</h2>
                  <p>${l.description}</p>
                  ${l.questions.map(r=>`
                        <div class="question">
                          <strong>Prompt:</strong> ${r.prompt}
                          ${r.options?`<ol>${r.options.map(H=>`<li>${H}</li>`).join("")}</ol>`:""}
                          <p><strong>Answer:</strong> ${r.answer}</p>
                          <p><em>${r.rationale}</em></p>
                        </div>
                      `).join("")}
                  ${l.remediation.length?`<h3>Remediation</h3><ul>${l.remediation.map(r=>`<li>${r}</li>`).join("")}</ul>`:""}
                </section>
              `).join("")}
        </body>
      </html>`;a.document.write(i),a.document.close(),a.focus(),a.print()}return c?s.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("div",{className:"badge",children:"AI assignment builder"}),s.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Generate standards-aligned assessments"}),L&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(99,102,241,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14},children:[s.jsx("strong",{style:{display:"block",marginBottom:6,color:"#cbd5f5",letterSpacing:.3},children:"Linked mastery insight"}),L]}),s.jsxs("form",{onSubmit:U,style:{display:"grid",gap:16},children:[s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-title",children:"Assignment title"}),s.jsx("input",{id:"assignment-title",name:"assignment-title",value:b,onChange:e=>N(e.target.value),placeholder:"e.g., Expressions mastery checkpoint",required:!0})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-subject",children:"Subject"}),s.jsxs("select",{id:"assignment-subject",name:"assignment-subject",value:u,onChange:e=>P(e.target.value),children:[s.jsx("option",{value:"",children:"Select a subject"}),x.map(e=>s.jsx("option",{value:e.id,children:e.label},e.id))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-grade",children:"Grade level"}),s.jsxs("select",{id:"assignment-grade",name:"assignment-grade",value:m,onChange:e=>_(e.target.value),disabled:!u,children:[s.jsx("option",{value:"",children:"Select grade 6, 7, or 8"}),["6","7","8"].map(e=>s.jsxs("option",{value:e,children:["Grade ",e]},e))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-standard",children:"Standard"}),s.jsxs("select",{id:"assignment-standard",name:"assignment-standard",value:p,onChange:e=>f(e.target.value),disabled:!m||y.length===0,children:[s.jsx("option",{value:"",children:"Select a standard"}),y.map(e=>s.jsxs("option",{value:e.code,children:[e.code," — ",e.name]},e.code))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-type",children:"Assessment type"}),s.jsx("select",{id:"assignment-type",name:"assignment-type",value:S,onChange:e=>W(e.target.value),children:G.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-questions",children:"Question count"}),s.jsx("select",{id:"assignment-questions",name:"assignment-questions",value:$,onChange:e=>O(Number(e.target.value)),children:[5,10,15].map(e=>s.jsxs("option",{value:e,children:[e," questions"]},e))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-due",children:"Due date"}),s.jsx("input",{id:"assignment-due",name:"assignment-due",type:"date",value:A,onChange:e=>C(e.target.value)})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:12},children:[s.jsx("input",{type:"checkbox",checked:w,onChange:e=>Q(e.target.checked)}),"Include remediation pathways"]}),s.jsx("button",{type:"submit",className:"primary",disabled:T,children:T?"Generating…":"Generate and save assignment"})]}),I&&s.jsx("p",{style:{marginTop:8,color:"var(--text-muted)"},children:I})]}),s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:24,fontWeight:700},children:"Assignments library"}),s.jsx("p",{style:{color:"var(--text-muted)",marginTop:4},children:"Print, remediate, or assign at any time."})]})}),k.length===0?s.jsx("div",{className:"empty-state",children:"Generate an assignment to populate this library."}):s.jsx("div",{style:{display:"grid",gap:16},children:k.map(e=>s.jsxs("article",{className:"glass-subcard",style:{border:"1px solid rgba(148,163,184,0.25)",borderRadius:18,padding:18,background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[s.jsxs("div",{children:[s.jsx("h4",{style:{margin:0,fontSize:20},children:e.title}),e.blueprint&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:[e.blueprint.standardCode," · ",e.blueprint.assessmentType.replace(/_/g," ")," · ",e.blueprint.questionCount," questions"]}),e.dueDate&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:["Due ",new Date(e.dueDate).toLocaleDateString()]})]}),s.jsx("span",{className:"tag",style:{textTransform:"capitalize"},children:e.status})]}),e.blueprint&&s.jsxs("div",{style:{display:"grid",gap:12},children:[s.jsxs("div",{children:[s.jsx("strong",{children:"AI insights"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.classStrategies.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Remediation"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.levels.flatMap(a=>a.remediation).slice(0,3).map((a,t)=>s.jsx("li",{children:a},t))})]})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[s.jsx("button",{className:"secondary",onClick:()=>z(e.id,"assigned"),children:"Mark assigned"}),s.jsx("button",{className:"secondary",onClick:()=>z(e.id,"completed"),children:"Mark complete"}),s.jsx("button",{className:"secondary",onClick:()=>Y(e),children:"Print"}),s.jsx("button",{className:"secondary",onClick:()=>J(e.id),children:"Delete"})]})]},e.id))})]})]}):s.jsxs("div",{className:"glass-card fade-in",children:[s.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Authenticate to manage assignments"}),s.jsx("p",{style:{color:"var(--text-muted)"},children:"Assignments and AI blueprints are saved privately to your workspace. No student data leaves your secured scope."})]})}export{de as default};
