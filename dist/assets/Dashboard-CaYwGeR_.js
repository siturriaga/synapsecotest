import{r,j as e,u as K,d as M}from"./index-BhJrdxT9.js";import{m as X,k as L,q as F,h as H,j as $}from"./firebase-BZTKtPSO.js";const E=[{id:"sunrise",gradient:"linear-gradient(140deg, rgba(254,215,170,0.35), rgba(129,140,248,0.2))",caption:"Line up your goals while the day is fresh â€” Gemini is ready to draft supports.",greeting:"Good morning",icon:"ğŸŒ…",iconColor:"#fbbf24"},{id:"day",gradient:"linear-gradient(140deg, rgba(14,165,233,0.28), rgba(59,130,246,0.24))",caption:"Midday momentum keeps every learner on track with just-in-time insights.",greeting:"Good afternoon",icon:"â˜€ï¸",iconColor:"#fde68a"},{id:"sunset",gradient:"linear-gradient(140deg, rgba(249,115,22,0.28), rgba(168,85,247,0.24))",caption:"Capture wins, gaps, and reassignment needs before the sun goes down.",greeting:"Good evening",icon:"ğŸŒ‡",iconColor:"#fb923c"},{id:"night",gradient:"linear-gradient(160deg, rgba(15,118,110,0.28), rgba(99,102,241,0.28))",caption:"Night mode engaged â€” prep tomorrowâ€™s breakthroughs with calm clarity.",greeting:"Good night",icon:"ğŸŒ™",iconColor:"#a5b4fc"}];function Y(t){const d=t.getHours();return d<10?E[0]:d<16?E[1]:d<20?E[2]:E[3]}function Z(t){return(t.getHours()*60+t.getMinutes()+t.getSeconds()/60)/1440*360}function ee(){const[t,d]=r.useState(()=>new Date);r.useEffect(()=>{const S=window.setInterval(()=>{d(new Date)},1e3);return()=>window.clearInterval(S)},[]);const p=r.useMemo(()=>Y(t),[t]),C=r.useMemo(()=>{const S=Z(t),k=t.getSeconds()/60;return S+Math.sin(k*2*Math.PI)*6},[t]),R=r.useMemo(()=>new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"2-digit"}).format(t),[t]),T=r.useMemo(()=>new Intl.DateTimeFormat(void 0,{weekday:"long",month:"long",day:"numeric"}).format(t),[t]);return e.jsxs("section",{className:`glass-card dynamic-welcome ${p.id}`,style:{marginBottom:28,backgroundImage:p.gradient},children:[e.jsxs("div",{className:`welcome-orb ${p.id}`,"aria-hidden":!0,style:{"--welcome-rotation":`${C}deg`},children:[e.jsx("div",{className:"welcome-orb__glow"}),e.jsx("div",{className:"welcome-orb__core"}),e.jsx("div",{className:"welcome-orb__trail"}),e.jsx("div",{className:"welcome-orb__celestial",style:{color:p.iconColor},children:e.jsx("span",{children:p.icon})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"Dynamic welcome"}),e.jsxs("h1",{style:{fontSize:34,margin:"12px 0 6px",fontWeight:800},children:[p.greeting,", educator."]}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:16,maxWidth:520},children:p.caption}),e.jsxs("div",{style:{display:"flex",gap:14,marginTop:16,alignItems:"center",color:"rgba(226,232,240,0.8)"},children:[e.jsx("span",{style:{fontSize:18,fontWeight:700},children:R}),e.jsx("span",{style:{opacity:.7},children:T})]})]})]})}function se({cards:t}){return e.jsx("div",{className:"card-grid card-grid-4",children:t.map(d=>e.jsxs("article",{className:"glass-card fade-in",children:[e.jsx("div",{style:{fontSize:13,letterSpacing:"0.08em",textTransform:"uppercase",color:"var(--text-muted)"},children:d.label}),e.jsx("div",{style:{fontSize:40,fontWeight:900,marginTop:12},children:d.displayValue??d.value}),d.delta&&e.jsx("div",{className:"tag",style:{marginTop:10},children:d.delta})]},d.id))})}function ne({user:t,loading:d}){const[p,C]=r.useState([]),[R,T]=r.useState([]),[S,k]=r.useState([]),[G,P]=r.useState(null),[U,Q]=r.useState([]),{records:j,summaries:J,students:m,insights:te,groupInsights:B,pedagogy:V}=K(),[f,O]=r.useState("all"),[y,_]=r.useState("");r.useEffect(()=>{!y&&m.length&&_(m[0].id)},[m,y]),r.useEffect(()=>{y&&m.every(s=>s.id!==y)&&_(m[0]?.id??"")},[m,y]);const D=r.useMemo(()=>{const s=new Set;return j.forEach(g=>{g.period!==null&&g.period!==void 0&&s.add(String(g.period))}),Array.from(s).sort((g,x)=>Number(g)-Number(x))},[j]);r.useEffect(()=>{f!=="all"&&!D.includes(f)&&O(D[0]??"all")},[D,f]);const W=U.length?U:J,c=r.useMemo(()=>{if(G)return G;const s=W[0];return s?{testName:s.testName,period:s.period,quarter:s.quarter,studentCount:s.studentCount??void 0,averageScore:s.averageScore,maxScore:s.maxScore,minScore:s.minScore}:null},[G,W]),N=r.useMemo(()=>f==="all"?j:j.filter(s=>String(s.period??"")===f),[j,f]),u=r.useMemo(()=>{if(!N.length)return null;const s=N.filter(a=>typeof a.score=="number"),g=Array.from(new Set(N.map(a=>a.testName).filter(a=>!!a)));if(!s.length)return{average:null,topRecord:null,bottomRecord:null,total:N.length,assessments:g};const x=s.map(a=>a.score),A=x.length?x.reduce((a,h)=>a+h,0)/x.length:null,v=s.reduce((a,h)=>a?h.score>(a.score??-1/0)?h:a:h,null),z=s.reduce((a,h)=>a?h.score<(a.score??1/0)?h:a:h,null);return{average:A,topRecord:v,bottomRecord:z,total:N.length,assessments:g}},[N]),o=r.useMemo(()=>m.length?m.find(s=>s.id===y)??m[0]:null,[m,y]),I=r.useMemo(()=>o?j.filter(s=>s.studentId===o.id||!s.studentId&&s.displayName===o.displayName):[],[j,o]),w=r.useMemo(()=>{if(!o)return null;const s=I.filter(v=>typeof v.score=="number"),g=s.length?s.reduce((v,z)=>v+z.score,0)/s.length:null,x=I[0]??null,A=I.slice(0,3);return{average:g,latest:x,recent:A}},[I,o]);return r.useEffect(()=>{if(!t){C([]),T([]),k([]),Q([]),P(null);return}const s=X(M,`users/${t.uid}/dashboard_stats/metrics`),g=L(s,b=>{const i=b.data()||{},l=[];if(typeof i.totalEnrollment=="number"&&l.push({id:"enrollment",label:"Learners scored",value:i.totalEnrollment}),i.latestAssessment){const n=i.latestAssessment;P(n);const q=n.averageScore??null;l.push({id:"latest-average",label:"Latest class average",value:q??0,displayValue:q!==null?q.toFixed(1):"â€”"}),typeof n.studentCount=="number"&&l.push({id:"latest-count",label:"Students assessed",value:n.studentCount})}else P(null);typeof i.groupCount=="number"&&l.push({id:"groups",label:"Active Groups",value:i.groupCount??0,delta:i.groupDelta??void 0}),typeof i.onTrack=="number"&&l.push({id:"on-track",label:"On Track",value:i.onTrack??0,delta:i.onTrackDelta??void 0}),typeof i.atRisk=="number"&&l.push({id:"at-risk",label:"Needs Support",value:i.atRisk??0,delta:i.atRiskDelta??void 0}),l.length===0&&l.push({id:"placeholder",label:"Data incoming",value:0,displayValue:"â€”"}),C(l)}),x=F($(M,`users/${t.uid}/logs`),H("createdAt","desc")),A=L(x,b=>{const i=[];b.forEach(l=>{const n=l.data();i.push({id:l.id,title:n.title??"Insight",detail:n.detail??n.message??"Gemini generated an insight.",createdAt:n.createdAt?.toDate?.()??null})}),T(i.slice(0,5))}),v=F($(M,`users/${t.uid}/assignments`),H("dueDate","asc")),z=L(v,b=>{const i=[];b.forEach(l=>{const n=l.data();i.push({id:l.id,title:n.title??"Untitled assignment",dueDate:n.dueDate,status:n.status??"draft"})}),k(i.slice(0,4))}),a=F($(M,`users/${t.uid}/assessments_summary`),H("updatedAt","desc")),h=L(a,b=>{const i=[];b.forEach(l=>{const n=l.data();i.push({id:l.id,testName:n.testName??"Assessment",period:n.period,quarter:n.quarter,studentCount:n.studentCount,averageScore:n.averageScore,maxScore:n.maxScore,minScore:n.minScore,updatedAt:n.updatedAt?.toDate?.()??null})}),Q(i.slice(0,3))});return()=>{g(),A(),z(),h()}},[t]),d?e.jsx("div",{className:"glass-card",children:"Loading your workspaceâ€¦"}):t?e.jsxs("div",{className:"fade-in",children:[e.jsx(ee,{}),e.jsxs("section",{style:{display:"grid",gap:28},children:[e.jsx(se,{cards:p}),e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsx("div",{className:"badge",children:"Class & student explorer"}),e.jsxs("div",{style:{display:"grid",gap:18,gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))"},children:[e.jsxs("div",{className:"glass-subcard",style:{padding:18,borderRadius:18,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsx("strong",{children:"Class view"}),e.jsxs("select",{value:f,onChange:s=>O(s.target.value),className:"table-input",style:{maxWidth:160},children:[e.jsx("option",{value:"all",children:"All periods"}),D.map(s=>e.jsxs("option",{value:s,children:["Period ",s]},s))]})]}),u?e.jsxs("div",{style:{display:"grid",gap:10,fontSize:14},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Students"}),e.jsx("div",{style:{fontSize:24,fontWeight:700},children:u.total})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Average"}),e.jsx("div",{style:{fontSize:22,fontWeight:700},children:u.average!==null?u.average.toFixed(1):"â€”"})]}),u.topRecord&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Top performer"}),e.jsxs("div",{style:{marginTop:4},children:[u.topRecord.displayName," Â· ",u.topRecord.score??"â€”"]})]}),u.bottomRecord&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Needs support"}),e.jsxs("div",{style:{marginTop:4},children:[u.bottomRecord.displayName," Â· ",u.bottomRecord.score??"â€”"]})]}),u.assessments.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Assessments"}),e.jsx("div",{style:{marginTop:4},children:u.assessments.join(", ")})]}),B.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Groups"}),e.jsx("ul",{style:{margin:"6px 0 0 16px",padding:0,display:"grid",gap:4,color:"var(--text-muted)",listStyle:"disc"},children:B.slice(0,3).map(s=>e.jsxs("li",{children:[s.label,": ",s.range]},s.id))})]}),V?.summary&&e.jsx("p",{style:{margin:0,color:"var(--text-muted)",fontSize:13},children:V.summary})]}):e.jsx("p",{style:{color:"var(--text-muted)",fontSize:14,margin:"4px 0 0"},children:"Upload roster data to populate class metrics."})]}),e.jsxs("div",{className:"glass-subcard",style:{padding:18,borderRadius:18,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsx("strong",{children:"Student focus"}),e.jsx("select",{value:y,onChange:s=>_(s.target.value),className:"table-input",style:{maxWidth:200},children:m.map(s=>e.jsx("option",{value:s.id,children:s.displayName},s.id))})]}),o?e.jsxs("div",{style:{display:"grid",gap:10,fontSize:14},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Latest score"}),e.jsxs("div",{style:{marginTop:4},children:[o.lastScore!==null&&o.lastScore!==void 0?o.lastScore:"â€”",o.lastAssessment&&` Â· ${o.lastAssessment}`]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Average"}),e.jsx("div",{style:{marginTop:4},children:w?.average!==null&&w?.average!==void 0?w.average.toFixed(1):"â€”"})]}),o.periodHistory&&o.periodHistory.length>0&&e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Period history"}),e.jsx("div",{style:{marginTop:4},children:Array.from(new Set(o.periodHistory.filter(s=>s!=null))).join(", ")})]}),w?.recent.length?e.jsxs("div",{children:[e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:"Recent mastery"}),e.jsx("ul",{style:{margin:"6px 0 0 16px",padding:0,display:"grid",gap:4,color:"var(--text-muted)",listStyle:"disc"},children:w.recent.map(s=>e.jsxs("li",{children:[s.testName??"Assessment"," Â· ",s.score??"â€”"]},s.id))})]}):null]}):e.jsx("p",{style:{color:"var(--text-muted)",fontSize:14,margin:"4px 0 0"},children:"Upload roster data to view individual trends."})]})]})]}),c&&e.jsxs("section",{className:"glass-card",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"Latest mastery upload"}),e.jsx("h3",{style:{margin:"12px 0 0",fontSize:24,fontWeight:700},children:c.testName})]}),c.period&&c.quarter&&e.jsxs("span",{className:"tag",children:["Period ",c.period," Â· ",c.quarter]})]}),e.jsx("div",{style:{display:"grid",gap:12,marginTop:18},children:e.jsxs("div",{style:{display:"flex",gap:18,flexWrap:"wrap"},children:[e.jsxs("div",{className:"glass-subcard",style:{padding:16,borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.55)"},children:[e.jsx("strong",{children:"Average"}),e.jsx("div",{style:{fontSize:26,fontWeight:700,marginTop:6},children:c.averageScore!==null&&c.averageScore!==void 0?c.averageScore.toFixed(1):"â€”"})]}),e.jsxs("div",{className:"glass-subcard",style:{padding:16,borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.55)"},children:[e.jsx("strong",{children:"Range"}),e.jsxs("div",{style:{marginTop:6},children:["High ",c.maxScore??"â€”"," Â· Low ",c.minScore??"â€”"]})]}),e.jsxs("div",{className:"glass-subcard",style:{padding:16,borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.55)"},children:[e.jsx("strong",{children:"Learners"}),e.jsx("div",{style:{fontSize:26,fontWeight:700,marginTop:6},children:c.studentCount??"â€”"})]})]})})]}),W.length>0&&e.jsxs("section",{className:"glass-card",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"Assessment history"}),e.jsx("h3",{style:{margin:"12px 0 0",fontSize:24,fontWeight:700},children:"Recent uploads"})]}),e.jsx("a",{href:"/assignments",style:{color:"var(--accent)",fontWeight:600},children:"Design follow-ups â†’"})]}),e.jsxs("table",{className:"table",style:{marginTop:18},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Assessment"}),e.jsx("th",{children:"Period"}),e.jsx("th",{children:"Quarter"}),e.jsx("th",{children:"Avg"}),e.jsx("th",{children:"High"}),e.jsx("th",{children:"Low"}),e.jsx("th",{children:"Updated"})]})}),e.jsx("tbody",{children:W.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.testName}),e.jsx("td",{children:s.period??"â€”"}),e.jsx("td",{children:s.quarter??"â€”"}),e.jsx("td",{children:s.averageScore!==null&&s.averageScore!==void 0?s.averageScore.toFixed(1):"â€”"}),e.jsx("td",{children:s.maxScore??"â€”"}),e.jsx("td",{children:s.minScore??"â€”"}),e.jsx("td",{children:s.updatedAt?s.updatedAt.toLocaleString():"â€”"})]},s.id))})]})]}),e.jsxs("section",{className:"glass-card",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"Live oversight"}),e.jsx("h3",{style:{margin:"12px 0 0",fontSize:24,fontWeight:700},children:"Pulse updates"})]}),e.jsx("a",{href:"/groups",style:{color:"var(--accent)",fontWeight:600},children:"Review groups â†’"})]}),R.length===0?e.jsx("div",{className:"empty-state",style:{marginTop:18},children:"No Gemini actions logged yet. Generate student groups or lessons to see reflective insights here."}):e.jsx("ul",{style:{listStyle:"none",padding:0,marginTop:22,display:"grid",gap:16},children:R.map(s=>e.jsxs("li",{style:{border:"1px solid rgba(148,163,184,0.2)",borderRadius:14,padding:16},children:[e.jsx("div",{style:{fontWeight:600},children:s.title}),e.jsx("div",{style:{color:"var(--text-muted)",marginTop:4},children:s.detail}),s.createdAt&&e.jsx("div",{style:{fontSize:12,marginTop:10,color:"rgba(148,163,184,0.7)"},children:s.createdAt.toLocaleString()})]},s.id))})]}),e.jsxs("section",{className:"glass-card",children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"Upcoming"}),e.jsx("h3",{style:{margin:"12px 0 0",fontSize:24,fontWeight:700},children:"Assignments radar"})]}),e.jsx("a",{href:"/assignments",style:{color:"var(--accent)",fontWeight:600},children:"Manage assignments â†’"})]}),S.length===0?e.jsx("div",{className:"empty-state",style:{marginTop:18},children:"Create differentiated assignments from any standard to monitor mastery progress here."}):e.jsxs("table",{className:"table",style:{marginTop:18},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Assignment"}),e.jsx("th",{children:"Due date"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:S.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.title}),e.jsx("td",{children:s.dueDate?new Date(s.dueDate).toLocaleDateString():"No due date"}),e.jsx("td",{style:{textTransform:"capitalize"},children:s.status})]},s.id))})]})]})]})]}):e.jsxs("div",{className:"glass-card fade-in",children:[e.jsx("h2",{style:{fontSize:28,margin:"0 0 12px",fontWeight:800},children:"Authenticate to launch Synapse"}),e.jsx("p",{style:{color:"var(--text-muted)",maxWidth:520},children:"Sign in with your Google Workspace educator account to unlock roster uploads, Gemini-powered grouping, and live mastery analytics."})]})}export{ne as default};
