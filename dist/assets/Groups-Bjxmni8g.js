import{r as n,j as e,d as C}from"./index-BdaUekzB.js";import{r as w,j as G}from"./firebase-DMftn6xT.js";import{s as f}from"./safeFetch-CLicF8cn.js";function R({user:l}){const[r,u]=n.useState([]),[g,d]=n.useState(!1),[p,h]=n.useState([]),[c,m]=n.useState("heterogeneous"),[y,a]=n.useState(null),[x,j]=n.useState([]);n.useEffect(()=>{async function s(){if(!l){u([]);return}const t=await w(G(C,`users/${l.uid}/roster`)),i=[];t.forEach(N=>{const o=N.data();i.push({name:o.name??"Unknown",email:o.email,period:o.period??null,quarter:o.quarter??null,readiness:o.readiness??o.level??null})}),u(i)}s().catch(t=>{console.error(t),a("Failed to load roster. Ensure Firestore security rules allow access for your account.")})},[l]);const S=n.useMemo(()=>{if(r.length===0)return"No roster loaded";const s=new Set(r.map(i=>i.period).filter(Boolean)),t=new Set(r.map(i=>i.quarter).filter(Boolean));return`${r.length} students • Periods ${Array.from(s).join(", ")||"n/a"} • Quarters ${Array.from(t).join(", ")||"n/a"}`},[r]);async function b(){if(!l){a("Sign in to access Gemini grouping.");return}d(!0),a(null);try{const s=await f("/.netlify/functions/groupStudents",{method:"POST",body:JSON.stringify({mode:c})});h(s.groups),s.promptChips&&s.promptChips.length&&j(s.promptChips)}catch(s){console.error(s),a(s?.message??"Gemini grouping failed. Check logs for details.")}finally{d(!1)}}async function v(s){d(!0),a(null);try{const t=await f("/.netlify/functions/groupStudents",{method:"POST",body:JSON.stringify({mode:c,refinement:s})});h(t.groups)}catch(t){console.error(t),a(t?.message??"Unable to refine groups.")}finally{d(!1)}}return l?e.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"AI grouping"}),e.jsx("h2",{style:{margin:"12px 0 0",fontSize:28,fontWeight:800},children:"Student groups orchestrated by Gemini"}),e.jsx("p",{style:{color:"var(--text-muted)",marginTop:8},children:S})]}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("button",{className:"secondary",onClick:()=>m("heterogeneous"),style:{opacity:c==="heterogeneous"?1:.6},children:"Heterogeneous"}),e.jsx("button",{className:"secondary",onClick:()=>m("homogeneous"),style:{opacity:c==="homogeneous"?1:.6},children:"Homogeneous"})]})]}),e.jsx("div",{className:"chip-row",children:x.map(s=>e.jsx("div",{className:"chip",onClick:()=>v(s),children:s},s))}),e.jsx("button",{className:"primary",onClick:b,disabled:g||r.length===0,children:g?"Generating groups…":"Generate instructional groups"}),y&&e.jsx("div",{style:{color:"#fecaca"},children:y})]}),e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsx("h3",{style:{margin:0,fontSize:22,fontWeight:700},children:"Recommended groups"}),p.length===0?e.jsx("div",{className:"empty-state",children:r.length===0?"Upload a roster first to unlock grouping suggestions.":"Run Gemini grouping to populate cohorts."}):e.jsx("div",{style:{display:"grid",gap:18},children:p.map(s=>e.jsxs("div",{style:{border:"1px solid rgba(148,163,184,0.2)",borderRadius:18,padding:18,background:"rgba(15, 23, 42, 0.55)"},children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 6px",fontSize:20},children:s.name}),e.jsx("p",{style:{color:"var(--text-muted)",margin:0},children:s.rationale})]}),e.jsxs("span",{className:"tag",children:[s.students.length," learners"]})]}),e.jsx("ul",{style:{marginTop:16,listStyle:"none",padding:0,display:"grid",gap:8},children:s.students.map(t=>e.jsxs("li",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:t.name}),e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:t.readiness||"readiness n/a"})]},t.email))})]},s.id))})]})]}):e.jsxs("div",{className:"glass-card fade-in",children:[e.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Sign in required"}),e.jsx("p",{style:{color:"var(--text-muted)"},children:"Authenticate to let Gemini analyze your roster data and recommend instructional groupings."})]})}export{R as default};
