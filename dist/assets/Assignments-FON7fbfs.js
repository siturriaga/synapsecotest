import{r as i,u as Z,d as b,j as s}from"./index-DgwxT1Iv.js";import{j as F,k as ee,t as se,T as te,u as ae,m as E,v as ne}from"./firebase-DMftn6xT.js";import{c as ie}from"./catalog-hwBwqGgt.js";import{s as le}from"./safeFetch-Ddwfznwp.js";const _=[{value:"multiple_choice",label:"Multiple choice quiz"},{value:"reading_plus",label:"Reading plus text-dependent questions"},{value:"matching",label:"Matching definitions to concepts"}];function ue({user:c}){const j=i.useMemo(()=>ie.subjects,[]),[p,W]=i.useState(""),[m,O]=i.useState(""),[h,f]=i.useState(""),[v,$]=i.useState([]),[C,Q]=i.useState(_[0].value),[N,B]=i.useState(5),[S,A]=i.useState(""),[I,w]=i.useState(""),[k,U]=i.useState(!0),[P,x]=i.useState(""),[D,T]=i.useState(!1),[L,M]=i.useState([]),{insights:d,summaries:q,records:z,groupInsights:u,pedagogy:o}=Z(),g=i.useMemo(()=>q[0]??null,[q]),y=i.useMemo(()=>{const e=z.filter(t=>typeof t.score=="number");return e.length?[...e].sort((t,n)=>{const l=t.score??0,r=n.score??0;return l-r}).slice(0,3).map(t=>`${t.displayName} (${t.score??"—"})`):[]},[z]),J=i.useMemo(()=>{const e=[];if(g?.testName){const n=g.averageScore!==null?`averaged ${g.averageScore.toFixed(1)}`:"is awaiting average calculations";e.push(`Latest assessment ${g.testName} ${n}.`)}d?.highest?.name&&d.highest.score!==null&&e.push(`${d.highest.name} is excelling at ${d.highest.score}.`),y.length&&e.push(`Learners needing support: ${y.join(", ")}.`),o?.summary&&e.push(o.summary);const a=u.find(n=>n.id==="foundation");a&&e.push(`Design scaffolds with student voice for ${a.studentCount} learners in the ${a.label.toLowerCase()} group.`);const t=u.find(n=>n.id==="extending");return t&&e.push(`Activate ${t.studentCount} ${t.label.toLowerCase()} learners as peer mentors and co-designers.`),e.length||e.push("Use evidence-based instructional strategies connected to recent mastery trends."),e.join(" ")},[d,g,y,o,u]),R=i.useMemo(()=>{if(!d||!g)return"Upload mastery rosters so the AI can anchor prompts to real class data.";const e=[];if(e.push(`Latest: ${g.testName}${g.averageScore!==null?` · Avg ${g.averageScore.toFixed(1)}`:""}`),d.highest?.name&&d.highest.score!==null&&e.push(`Top: ${d.highest.name} ${d.highest.score}`),y.length&&e.push(`Needs support: ${y.join(", ")}`),u.length){const a=u.map(t=>`${t.label.replace(/\s+/g," ")} ${t.range}`).join(" • ");e.push(`Groups: ${a}`)}return e.join(" • ")},[d,g,y,u]),Y=i.useMemo(()=>({pedagogy:o?{summary:o.summary,bestPractices:o.bestPractices,reflectionPrompts:o.reflectionPrompts}:null,groups:u.map(e=>({id:e.id,label:e.label,range:e.range,studentCount:e.studentCount,recommendedPractices:e.recommendedPractices,studentNames:e.students.map(a=>a.name)}))}),[u,o]);i.useEffect(()=>{if(!p||!m){$([]),f("");return}const a=j.find(t=>t.id===p)?.grades?.[m]?.standards??[];$(a),a.some(t=>t.code===h)||f(a[0]?.code??"")},[p,m,j,h]),i.useEffect(()=>{if(!c){M([]);return}const e=F(b,`users/${c.uid}/assignments`),a=ee(e,t=>{const n=[];t.forEach(l=>{const r=l.data();n.push({id:l.id,title:r.title??"AI assignment",status:r.status??"draft",dueDate:r.dueDate,blueprint:r.blueprint,createdAt:r.createdAt?.toDate?.()?.toISOString?.()??null})}),M(n)});return()=>a()},[c]);async function H(e){if(e.preventDefault(),!c)return;if(!p||!m||!h){x("Complete the subject, grade, and standard selections.");return}if(!S.trim()){x("Provide a title so the assignment is easy to find later.");return}const a=j.find(n=>n.id===p)?.label??p,t=v.find(n=>n.code===h);try{T(!0),x("Generating AI assessment…");const n=await le("/.netlify/functions/generateAssignment",{method:"POST",body:JSON.stringify({standardCode:h,standardName:t?.name??h,focus:J,subject:a,grade:m,assessmentType:C,questionCount:N,includeRemediation:k,classContext:Y})});await se(F(b,`users/${c.uid}/assignments`),{title:S,status:"draft",dueDate:I||null,createdAt:te.now(),blueprint:n,standardCode:n.standardCode,assessmentType:n.assessmentType,questionCount:n.questionCount}),x("Assignment generated and saved securely."),A(""),w("")}catch(n){console.error(n),x(n?.message??"Assignment generation failed.")}finally{T(!1)}}async function G(e,a){c&&(await ae(E(b,`users/${c.uid}/assignments/${e}`),{status:a}),x("Status updated."))}async function K(e){c&&(await ne(E(b,`users/${c.uid}/assignments/${e}`)),x("Assignment deleted."))}function V(e){if(!e.blueprint){window.print();return}const a=window.open("","_blank");if(!a)return;const t=e.blueprint,n=`<!doctype html>
      <html>
        <head>
          <meta charset="utf-8" />
          <title>${e.title}</title>
          <style>
            body { font-family: 'Inter', sans-serif; padding: 32px; color: #0f172a; }
            h1 { font-size: 24px; margin-bottom: 8px; }
            h2 { font-size: 18px; margin-top: 24px; }
            ul { margin: 0 0 16px 20px; }
            .question { border: 1px solid #cbd5f5; padding: 12px; border-radius: 12px; margin-bottom: 12px; }
          </style>
        </head>
        <body>
          <h1>${e.title}</h1>
          <p><strong>Standard:</strong> ${t.standardCode} — ${t.standardName}</p>
          <p><strong>Assessment type:</strong> ${t.assessmentType.replace(/_/g," ")}</p>
          <p><strong>Questions:</strong> ${t.questionCount}</p>
          <h2>AI overview</h2>
          <p>${t.aiInsights.overview}</p>
          <h2>Class strategies</h2>
          <ul>${t.aiInsights.classStrategies.map(l=>`<li>${l}</li>`).join("")}</ul>
          <h2>Next steps</h2>
          <ul>${t.aiInsights.nextSteps.map(l=>`<li>${l}</li>`).join("")}</ul>
          ${t.aiInsights.pedagogy?`<h2>Pedagogical focus</h2>
               <p>${t.aiInsights.pedagogy.summary}</p>
               <ul>${t.aiInsights.pedagogy.bestPractices.map(l=>`<li>${l}</li>`).join("")}</ul>
               <h3>Reflection prompts</h3>
               <ul>${t.aiInsights.pedagogy.reflectionPrompts.map(l=>`<li>${l}</li>`).join("")}</ul>`:""}
          ${t.levels.map(l=>`
                <section>
                  <h2>${l.level}</h2>
                  <p>${l.description}</p>
                  ${l.questions.map(r=>`
                        <div class="question">
                          <strong>Prompt:</strong> ${r.prompt}
                          ${r.options?`<ol>${r.options.map(X=>`<li>${X}</li>`).join("")}</ol>`:""}
                          <p><strong>Answer:</strong> ${r.answer}</p>
                          <p><em>${r.rationale}</em></p>
                        </div>
                      `).join("")}
                  ${l.remediation.length?`<h3>Remediation</h3><ul>${l.remediation.map(r=>`<li>${r}</li>`).join("")}</ul>`:""}
                </section>
              `).join("")}
        </body>
      </html>`;a.document.write(n),a.document.close(),a.focus(),a.print()}return c?s.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("div",{className:"badge",children:"AI assignment builder"}),s.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Generate standards-aligned assessments"}),R&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(99,102,241,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14},children:[s.jsx("strong",{style:{display:"block",marginBottom:6,color:"#cbd5f5",letterSpacing:.3},children:"Linked mastery insight"}),R]}),o&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14,display:"grid",gap:10},children:[s.jsx("strong",{style:{display:"block",color:"#cbd5f5",letterSpacing:.3},children:"Pedagogical commitments"}),s.jsx("p",{style:{margin:0},children:o.summary}),s.jsx("ul",{style:{margin:0,paddingLeft:18,display:"grid",gap:6},children:o.bestPractices.map((e,a)=>s.jsx("li",{children:e},a))})]}),u.length>0&&s.jsxs("div",{className:"glass-subcard",style:{borderRadius:16,border:"1px solid rgba(148,163,184,0.25)",background:"rgba(15,23,42,0.45)",padding:16,color:"var(--text-muted)",fontSize:14,display:"grid",gap:12},children:[s.jsx("strong",{style:{display:"block",color:"#cbd5f5",letterSpacing:.3},children:"Suggested learning groups"}),s.jsx("div",{style:{display:"grid",gap:10},children:u.map(e=>s.jsxs("div",{style:{display:"grid",gap:6},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",gap:12},children:[s.jsx("span",{style:{fontWeight:600,color:"#e0e7ff"},children:e.label}),s.jsxs("span",{style:{fontSize:13},children:[e.range," • ",e.studentCount," ",e.studentCount===1?"learner":"learners"]})]}),e.students.length>0&&s.jsxs("span",{style:{fontSize:13},children:["Learners: ",e.students.map(a=>a.name).join(", ")]}),s.jsx("ul",{style:{margin:0,paddingLeft:18,display:"grid",gap:4},children:e.recommendedPractices.map((a,t)=>s.jsx("li",{children:a},t))})]},e.id))})]}),s.jsxs("form",{onSubmit:H,style:{display:"grid",gap:16},children:[s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-title",children:"Assignment title"}),s.jsx("input",{id:"assignment-title",name:"assignment-title",value:S,onChange:e=>A(e.target.value),placeholder:"e.g., Expressions mastery checkpoint",required:!0})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-subject",children:"Subject"}),s.jsxs("select",{id:"assignment-subject",name:"assignment-subject",value:p,onChange:e=>W(e.target.value),children:[s.jsx("option",{value:"",children:"Select a subject"}),j.map(e=>s.jsx("option",{value:e.id,children:e.label},e.id))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-grade",children:"Grade level"}),s.jsxs("select",{id:"assignment-grade",name:"assignment-grade",value:m,onChange:e=>O(e.target.value),disabled:!p,children:[s.jsx("option",{value:"",children:"Select grade 6, 7, or 8"}),["6","7","8"].map(e=>s.jsxs("option",{value:e,children:["Grade ",e]},e))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-standard",children:"Standard"}),s.jsxs("select",{id:"assignment-standard",name:"assignment-standard",value:h,onChange:e=>f(e.target.value),disabled:!m||v.length===0,children:[s.jsx("option",{value:"",children:"Select a standard"}),v.map(e=>s.jsxs("option",{value:e.code,children:[e.code," — ",e.name]},e.code))]})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-type",children:"Assessment type"}),s.jsx("select",{id:"assignment-type",name:"assignment-type",value:C,onChange:e=>Q(e.target.value),children:_.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-questions",children:"Question count"}),s.jsx("select",{id:"assignment-questions",name:"assignment-questions",value:N,onChange:e=>B(Number(e.target.value)),children:[5,10,15].map(e=>s.jsxs("option",{value:e,children:[e," questions"]},e))})]}),s.jsxs("div",{className:"field",children:[s.jsx("label",{htmlFor:"assignment-due",children:"Due date"}),s.jsx("input",{id:"assignment-due",name:"assignment-due",type:"date",value:I,onChange:e=>w(e.target.value)})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:12},children:[s.jsx("input",{type:"checkbox",checked:k,onChange:e=>U(e.target.checked)}),"Include remediation pathways"]}),s.jsx("button",{type:"submit",className:"primary",disabled:D,children:D?"Generating…":"Generate and save assignment"})]}),P&&s.jsx("p",{style:{marginTop:8,color:"var(--text-muted)"},children:P})]}),s.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[s.jsx("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:s.jsxs("div",{children:[s.jsx("h3",{style:{margin:0,fontSize:24,fontWeight:700},children:"Assignments library"}),s.jsx("p",{style:{color:"var(--text-muted)",marginTop:4},children:"Print, remediate, or assign at any time."})]})}),L.length===0?s.jsx("div",{className:"empty-state",children:"Generate an assignment to populate this library."}):s.jsx("div",{style:{display:"grid",gap:16},children:L.map(e=>s.jsxs("article",{className:"glass-subcard",style:{border:"1px solid rgba(148,163,184,0.25)",borderRadius:18,padding:18,background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[s.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[s.jsxs("div",{children:[s.jsx("h4",{style:{margin:0,fontSize:20},children:e.title}),e.blueprint&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:[e.blueprint.standardCode," · ",e.blueprint.assessmentType.replace(/_/g," ")," · ",e.blueprint.questionCount," questions"]}),e.dueDate&&s.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:["Due ",new Date(e.dueDate).toLocaleDateString()]})]}),s.jsx("span",{className:"tag",style:{textTransform:"capitalize"},children:e.status})]}),e.blueprint&&s.jsxs("div",{style:{display:"grid",gap:12},children:[s.jsxs("div",{children:[s.jsx("strong",{children:"AI insights"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.classStrategies.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Remediation"}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.levels.flatMap(a=>a.remediation).slice(0,3).map((a,t)=>s.jsx("li",{children:a},t))})]}),e.blueprint.aiInsights.pedagogy&&s.jsxs("div",{children:[s.jsx("strong",{children:"Pedagogical focus"}),s.jsx("p",{style:{margin:"8px 0 0",color:"var(--text-muted)"},children:e.blueprint.aiInsights.pedagogy.summary}),s.jsx("ul",{style:{margin:"8px 0 0 18px"},children:e.blueprint.aiInsights.pedagogy.bestPractices.slice(0,2).map((a,t)=>s.jsx("li",{children:a},t))})]})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[s.jsx("button",{className:"secondary",onClick:()=>G(e.id,"assigned"),children:"Mark assigned"}),s.jsx("button",{className:"secondary",onClick:()=>G(e.id,"completed"),children:"Mark complete"}),s.jsx("button",{className:"secondary",onClick:()=>V(e),children:"Print"}),s.jsx("button",{className:"secondary",onClick:()=>K(e.id),children:"Delete"})]})]},e.id))})]})]}):s.jsxs("div",{className:"glass-card fade-in",children:[s.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Authenticate to manage assignments"}),s.jsx("p",{style:{color:"var(--text-muted)"},children:"Assignments and AI blueprints are saved privately to your workspace. No student data leaves your secured scope."})]})}export{ue as default};
