import{u as q,r as o,j as e}from"./index-Babasj67.js";import{s as S}from"./safeFetch-BFwNDYL7.js";import{A as b}from"./AssistedHint-QoWDV7PM.js";import"./firebase-BnXfUrx6.js";function N(r){return r===null||Number.isNaN(r)?null:r>=85?`Extending mastery (${Math.round(r)}%)`:r>=70?`Developing understanding (${Math.round(r)}%)`:`Foundation support needed (${Math.round(r)}%)`}function $({user:r}){const{students:c,records:p,loading:l}=q(),t=o.useMemo(()=>{if(c.length)return c.map(s=>{const a=typeof s.lastScore=="number"?s.lastScore:null;return{id:s.id,name:s.displayName,period:s.period??null,quarter:s.quarter??null,score:a,readiness:N(a)}});if(!p.length)return[];const n=new Map;return p.forEach(s=>{const a=s.studentId??s.displayName.toLowerCase(),g=typeof s.score=="number"?s.score:null,A=N(g),j=n.get(a);(!j||g!==null&&(j.score??-1/0)<g)&&n.set(a,{id:a,name:s.displayName,period:s.period??null,quarter:s.quarter??null,score:g,readiness:A})}),Array.from(n.values())},[p,c]),[h,d]=o.useState(!1),[m,f]=o.useState([]),[u,y]=o.useState("heterogeneous"),[x,i]=o.useState(null),[v,C]=o.useState([]),w=o.useMemo(()=>{if(t.length===0)return l?"Loading roster…":"No roster loaded";const n=new Set(t.map(a=>a.period).filter(Boolean)),s=new Set(t.map(a=>a.quarter).filter(Boolean));return`${t.length} students • Periods ${Array.from(n).join(", ")||"n/a"} • Quarters ${Array.from(s).join(", ")||"n/a"}`},[t,l]);async function G(){if(!r){i("Sign in to access Gemini grouping.");return}if(t.length===0){i("Upload a roster first to unlock grouping suggestions.");return}d(!0),i(null);try{const n=await S("/.netlify/functions/groupStudents",{method:"POST",body:JSON.stringify({mode:u})});f(n.groups),n.promptChips&&n.promptChips.length&&C(n.promptChips)}catch(n){console.error(n),i(n?.message??"Gemini grouping failed. Check logs for details.")}finally{d(!1)}}async function k(n){if(t.length===0){i("Upload a roster first to unlock grouping suggestions.");return}d(!0),i(null);try{const s=await S("/.netlify/functions/groupStudents",{method:"POST",body:JSON.stringify({mode:u,refinement:n})});f(s.groups)}catch(s){console.error(s),i(s?.message??"Unable to refine groups.")}finally{d(!1)}}return r?e.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{className:"badge",children:"AI grouping"}),e.jsx("h2",{style:{margin:"12px 0 0",fontSize:28,fontWeight:800},children:"Student groups orchestrated by Gemini"}),e.jsx("p",{style:{color:"var(--text-muted)",marginTop:8},children:w}),e.jsx(b,{id:"groups-upload-roster",message:"Upload a mastery roster so Synapse can analyze readiness and unlock Gemini grouping.",show:t.length===0&&!l})]}),e.jsxs("div",{style:{display:"flex",gap:10},children:[e.jsx("button",{className:"secondary",onClick:()=>y("heterogeneous"),style:{opacity:u==="heterogeneous"?1:.6},children:"Heterogeneous"}),e.jsx("button",{className:"secondary",onClick:()=>y("homogeneous"),style:{opacity:u==="homogeneous"?1:.6},children:"Homogeneous"})]})]}),e.jsx("div",{className:"chip-row",children:v.map(n=>e.jsx("div",{className:"chip",onClick:()=>k(n),children:n},n))}),e.jsx("button",{className:"primary",onClick:G,disabled:h||t.length===0||l,children:h?"Generating groups…":"Generate instructional groups"}),e.jsx(b,{id:"groups-generate",message:"Choose heterogeneous or homogeneous to shape the grouping logic, then tap Generate for AI recommendations.",show:!h&&t.length>0&&m.length===0}),x&&e.jsx("div",{style:{color:"#fecaca"},children:x})]}),e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsx("h3",{style:{margin:0,fontSize:22,fontWeight:700},children:"Recommended groups"}),m.length===0?e.jsx("div",{className:"empty-state",children:t.length===0?l?"Loading roster…":"Upload a roster first to unlock grouping suggestions.":"Run Gemini grouping to populate cohorts."}):e.jsx("div",{style:{display:"grid",gap:18},children:m.map(n=>e.jsxs("div",{style:{border:"1px solid rgba(148,163,184,0.2)",borderRadius:18,padding:18,background:"rgba(15, 23, 42, 0.55)"},children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:"0 0 6px",fontSize:20},children:n.name}),e.jsx("p",{style:{color:"var(--text-muted)",margin:0},children:n.rationale})]}),e.jsxs("span",{className:"tag",children:[n.students.length," learners"]})]}),e.jsx("ul",{style:{marginTop:16,listStyle:"none",padding:0,display:"grid",gap:8},children:n.students.map(s=>e.jsxs("li",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:s.name}),e.jsx("span",{style:{color:"var(--text-muted)",fontSize:13},children:s.readiness||"readiness n/a"})]},s.id??s.name))})]},n.id))})]})]}):e.jsxs("div",{className:"glass-card fade-in",children:[e.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Sign in required"}),e.jsx("p",{style:{color:"var(--text-muted)"},children:"Authenticate to let Gemini analyze your roster data and recommend instructional groupings."})]})}export{$ as default};
