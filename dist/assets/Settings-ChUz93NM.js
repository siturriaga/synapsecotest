import{r as a,u as F,b as E,j as e,d as v}from"./index-Babasj67.js";import{h as b,v as C,k as M}from"./firebase-BnXfUrx6.js";const l={timezone:"America/New_York",darkMode:"system",dyslexiaFont:!1,notifications:!0};function D({user:r}){const[i,n]=a.useState(l),[d,S]=a.useState(""),[c,o]=a.useState(null),[m,p]=a.useState(""),[h,f]=a.useState(""),[u,x]=a.useState(null),{snapshots:g,restoreSnapshot:k}=F(),{enabled:N,resetHints:w}=E();a.useEffect(()=>{async function s(){if(!r){n(l);return}const t=b(v,`users/${r.uid}/preferences/app`),j=await C(t);if(j.exists()){const A=j.data();n({...l,...A})}}s().catch(t=>{console.error(t),o("Failed to load preferences.")})},[r]);async function z(s){if(s.preventDefault(),!r){o("Sign in first.");return}try{const t=b(v,`users/${r.uid}/preferences/app`);await M(t,i,{merge:!0}),S("Preferences saved."),o(null)}catch(t){console.error(t),o(t?.message??"Failed to save preferences.")}}const y=a.useMemo(()=>g.map(s=>({...s,createdLabel:s.createdAt?s.createdAt.toLocaleString(void 0,{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):"—"})),[g]);async function R(s){if(s){f(""),p(""),x(s);try{await k(s),p("Snapshot restored. The workspace view will refresh with the selected version.")}catch(t){console.error(t),f(t?.message??"Unable to restore snapshot. Try again soon.")}finally{x(null)}}}return r?e.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[e.jsxs("section",{className:"glass-card",children:[e.jsx("div",{className:"badge",children:"Workspace preferences"}),e.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Workspace settings"}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"pref-timezone",children:"Timezone"}),e.jsx("input",{id:"pref-timezone",name:"pref-timezone",value:i.timezone,onChange:s=>n(t=>({...t,timezone:s.target.value})),required:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"pref-dark-mode",children:"Appearance"}),e.jsxs("select",{id:"pref-dark-mode",name:"pref-dark-mode",value:i.darkMode,onChange:s=>n(t=>({...t,darkMode:s.target.value})),children:[e.jsx("option",{value:"system",children:"Follow system"}),e.jsx("option",{value:"light",children:"Light mode"}),e.jsx("option",{value:"dark",children:"Dark mode"})]})]}),e.jsxs("div",{className:"field",style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("input",{id:"pref-dyslexia-font",name:"pref-dyslexia-font",type:"checkbox",checked:i.dyslexiaFont,onChange:s=>n(t=>({...t,dyslexiaFont:s.target.checked}))}),e.jsx("label",{htmlFor:"pref-dyslexia-font",style:{margin:0},children:"Enable dyslexia-friendly font"})]}),e.jsxs("div",{className:"field",style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("input",{id:"pref-notifications",name:"pref-notifications",type:"checkbox",checked:i.notifications,onChange:s=>n(t=>({...t,notifications:s.target.checked}))}),e.jsx("label",{htmlFor:"pref-notifications",style:{margin:0},children:"Email notifications for Gemini insights"})]}),e.jsx("button",{type:"submit",className:"primary",children:"Save preferences"})]}),d&&e.jsx("p",{style:{marginTop:12,color:"var(--text-muted)"},children:d}),c&&e.jsx("p",{style:{marginTop:12,color:"#fecaca"},children:c})]}),e.jsxs("section",{className:"glass-card",children:[e.jsx("div",{className:"badge",children:"Auto-save & backups"}),e.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Snapshot history"}),e.jsx("p",{style:{color:"var(--text-muted)",marginBottom:16},children:"Synapse auto-saves the entire workspace every few seconds and preserves the last ten versions. Restore a snapshot to roll back the shared roster context across dashboards, groups, and assignments."}),y.length?e.jsx("div",{style:{display:"grid",gap:12},children:y.map(s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid rgba(148, 163, 184, 0.2)",borderRadius:16,padding:"14px 18px",background:"rgba(15, 23, 42, 0.5)"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:s.createdLabel}),e.jsxs("div",{style:{fontSize:13,color:"var(--text-muted)"},children:[s.summary.totalStudents," students • ",s.summary.totalRecords," assessments • Latest assessment:",s.summary.latestAssessment?` ${s.summary.latestAssessment}`:" —"]})]}),e.jsx("button",{type:"button",className:"secondary",disabled:u===s.id,onClick:()=>{R(s.id)},children:u===s.id?"Restoring…":"Restore snapshot"})]},s.id))}):e.jsx("div",{className:"empty-state",children:"Snapshots will appear after your next auto-save cycle."}),m&&e.jsx("p",{style:{marginTop:12,color:"var(--text-muted)"},children:m}),h&&e.jsx("p",{style:{marginTop:12,color:"#fecaca"},children:h})]}),e.jsxs("section",{className:"glass-card",children:[e.jsx("div",{className:"badge",children:"Assisted Mode"}),e.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Hint preferences"}),e.jsxs("p",{style:{color:"var(--text-muted)",marginBottom:16},children:["Assisted Mode is currently ",e.jsx("strong",{children:N?"enabled":"disabled"}),". Clear saved hint dismissals if you want Synapse to surface micro-guidance again."]}),e.jsx("button",{type:"button",className:"secondary",onClick:()=>{w()},children:"Reset assisted hints"})]})]}):e.jsx("div",{className:"glass-card fade-in",children:e.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Authenticate to personalize Synapse"})})}export{D as default};
