import{r as i,d as g,j as e}from"./index-DXLrP2vc.js";import{l as k,j as O,n as Q,T as J,u as Y,h as q,p as B}from"./firebase-DnjqOjBc.js";import{c as H}from"./catalog-hwBwqGgt.js";import{s as K}from"./safeFetch-a-dzkaAs.js";const E=[{value:"multiple_choice",label:"Multiple choice quiz"},{value:"reading_plus",label:"Reading plus text-dependent questions"},{value:"matching",label:"Matching definitions to concepts"}];function ee({user:r}){const m=i.useMemo(()=>H.subjects,[]),[o,M]=i.useState(""),[c,z]=i.useState(""),[u,h]=i.useState(""),[x,y]=i.useState([]),[b,F]=i.useState(E[0].value),[f,G]=i.useState(5),[j,v]=i.useState(""),[S,$]=i.useState(""),[A,P]=i.useState(!0),[C,p]=i.useState(""),[N,w]=i.useState(!1),[I,D]=i.useState([]);i.useEffect(()=>{if(!o||!c){y([]),h("");return}const t=m.find(a=>a.id===o)?.grades?.[c]?.standards??[];y(t),t.some(a=>a.code===u)||h(t[0]?.code??"")},[o,c,m,u]),i.useEffect(()=>{if(!r){D([]);return}const s=k(g,`users/${r.uid}/assignments`),t=O(s,a=>{const n=[];a.forEach(d=>{const l=d.data();n.push({id:d.id,title:l.title??"AI assignment",status:l.status??"draft",dueDate:l.dueDate,blueprint:l.blueprint,createdAt:l.createdAt?.toDate?.()?.toISOString?.()??null})}),D(n)});return()=>t()},[r]);async function R(s){if(s.preventDefault(),!r)return;if(!o||!c||!u){p("Complete the subject, grade, and standard selections.");return}if(!j.trim()){p("Provide a title so the assignment is easy to find later.");return}const t=m.find(n=>n.id===o)?.label??o,a=x.find(n=>n.code===u);try{w(!0),p("Generating AI assessment…");const n=await K("/.netlify/functions/generateAssignment",{method:"POST",body:JSON.stringify({standardCode:u,standardName:a?.name??u,focus:"Align practice to recent mastery data and provide tiered remediation.",subject:t,grade:c,assessmentType:b,questionCount:f,includeRemediation:A})});await Q(k(g,`users/${r.uid}/assignments`),{title:j,status:"draft",dueDate:S||null,createdAt:J.now(),blueprint:n,standardCode:n.standardCode,assessmentType:n.assessmentType,questionCount:n.questionCount}),p("Assignment generated and saved securely."),v(""),$("")}catch(n){console.error(n),p(n?.message??"Assignment generation failed.")}finally{w(!1)}}async function T(s,t){r&&(await Y(q(g,`users/${r.uid}/assignments/${s}`),{status:t}),p("Status updated."))}async function _(s){r&&(await B(q(g,`users/${r.uid}/assignments/${s}`)),p("Assignment deleted."))}function L(s){if(!s.blueprint){window.print();return}const t=window.open("","_blank");if(!t)return;const a=s.blueprint,n=`<!doctype html>
      <html>
        <head>
          <meta charset="utf-8" />
          <title>${s.title}</title>
          <style>
            body { font-family: 'Inter', sans-serif; padding: 32px; color: #0f172a; }
            h1 { font-size: 24px; margin-bottom: 8px; }
            h2 { font-size: 18px; margin-top: 24px; }
            ul { margin: 0 0 16px 20px; }
            .question { border: 1px solid #cbd5f5; padding: 12px; border-radius: 12px; margin-bottom: 12px; }
          </style>
        </head>
        <body>
          <h1>${s.title}</h1>
          <p><strong>Standard:</strong> ${a.standardCode} — ${a.standardName}</p>
          <p><strong>Assessment type:</strong> ${a.assessmentType.replace(/_/g," ")}</p>
          <p><strong>Questions:</strong> ${a.questionCount}</p>
          <h2>AI overview</h2>
          <p>${a.aiInsights.overview}</p>
          <h2>Class strategies</h2>
          <ul>${a.aiInsights.classStrategies.map(d=>`<li>${d}</li>`).join("")}</ul>
          <h2>Next steps</h2>
          <ul>${a.aiInsights.nextSteps.map(d=>`<li>${d}</li>`).join("")}</ul>
          ${a.levels.map(d=>`
                <section>
                  <h2>${d.level}</h2>
                  <p>${d.description}</p>
                  ${d.questions.map(l=>`
                        <div class="question">
                          <strong>Prompt:</strong> ${l.prompt}
                          ${l.options?`<ol>${l.options.map(W=>`<li>${W}</li>`).join("")}</ol>`:""}
                          <p><strong>Answer:</strong> ${l.answer}</p>
                          <p><em>${l.rationale}</em></p>
                        </div>
                      `).join("")}
                  ${d.remediation.length?`<h3>Remediation</h3><ul>${d.remediation.map(l=>`<li>${l}</li>`).join("")}</ul>`:""}
                </section>
              `).join("")}
        </body>
      </html>`;t.document.write(n),t.document.close(),t.focus(),t.print()}return r?e.jsxs("div",{className:"fade-in",style:{display:"grid",gap:24},children:[e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsx("div",{className:"badge",children:"AI assignment builder"}),e.jsx("h2",{style:{margin:"12px 0 6px",fontSize:28,fontWeight:800},children:"Generate standards-aligned assessments"}),e.jsxs("form",{onSubmit:R,style:{display:"grid",gap:16},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-title",children:"Assignment title"}),e.jsx("input",{id:"assignment-title",name:"assignment-title",value:j,onChange:s=>v(s.target.value),placeholder:"e.g., Expressions mastery checkpoint",required:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-subject",children:"Subject"}),e.jsxs("select",{id:"assignment-subject",name:"assignment-subject",value:o,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"",children:"Select a subject"}),m.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-grade",children:"Grade level"}),e.jsxs("select",{id:"assignment-grade",name:"assignment-grade",value:c,onChange:s=>z(s.target.value),disabled:!o,children:[e.jsx("option",{value:"",children:"Select grade 6, 7, or 8"}),["6","7","8"].map(s=>e.jsxs("option",{value:s,children:["Grade ",s]},s))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-standard",children:"Standard"}),e.jsxs("select",{id:"assignment-standard",name:"assignment-standard",value:u,onChange:s=>h(s.target.value),disabled:!c||x.length===0,children:[e.jsx("option",{value:"",children:"Select a standard"}),x.map(s=>e.jsxs("option",{value:s.code,children:[s.code," — ",s.name]},s.code))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-type",children:"Assessment type"}),e.jsx("select",{id:"assignment-type",name:"assignment-type",value:b,onChange:s=>F(s.target.value),children:E.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-questions",children:"Question count"}),e.jsx("select",{id:"assignment-questions",name:"assignment-questions",value:f,onChange:s=>G(Number(s.target.value)),children:[5,10,15].map(s=>e.jsxs("option",{value:s,children:[s," questions"]},s))})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"assignment-due",children:"Due date"}),e.jsx("input",{id:"assignment-due",name:"assignment-due",type:"date",value:S,onChange:s=>$(s.target.value)})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("input",{type:"checkbox",checked:A,onChange:s=>P(s.target.checked)}),"Include remediation pathways"]}),e.jsx("button",{type:"submit",className:"primary",disabled:N,children:N?"Generating…":"Generate and save assignment"})]}),C&&e.jsx("p",{style:{marginTop:8,color:"var(--text-muted)"},children:C})]}),e.jsxs("section",{className:"glass-card",style:{display:"grid",gap:18},children:[e.jsx("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:24,fontWeight:700},children:"Assignments library"}),e.jsx("p",{style:{color:"var(--text-muted)",marginTop:4},children:"Print, remediate, or assign at any time."})]})}),I.length===0?e.jsx("div",{className:"empty-state",children:"Generate an assignment to populate this library."}):e.jsx("div",{style:{display:"grid",gap:16},children:I.map(s=>e.jsxs("article",{className:"glass-subcard",style:{border:"1px solid rgba(148,163,184,0.25)",borderRadius:18,padding:18,background:"rgba(15,23,42,0.55)",display:"grid",gap:12},children:[e.jsxs("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,fontSize:20},children:s.title}),s.blueprint&&e.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:[s.blueprint.standardCode," · ",s.blueprint.assessmentType.replace(/_/g," ")," · ",s.blueprint.questionCount," questions"]}),s.dueDate&&e.jsxs("p",{style:{color:"var(--text-muted)",marginTop:4},children:["Due ",new Date(s.dueDate).toLocaleDateString()]})]}),e.jsx("span",{className:"tag",style:{textTransform:"capitalize"},children:s.status})]}),s.blueprint&&e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"AI insights"}),e.jsx("ul",{style:{margin:"8px 0 0 18px"},children:s.blueprint.aiInsights.classStrategies.slice(0,2).map((t,a)=>e.jsx("li",{children:t},a))})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remediation"}),e.jsx("ul",{style:{margin:"8px 0 0 18px"},children:s.blueprint.levels.flatMap(t=>t.remediation).slice(0,3).map((t,a)=>e.jsx("li",{children:t},a))})]})]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[e.jsx("button",{className:"secondary",onClick:()=>T(s.id,"assigned"),children:"Mark assigned"}),e.jsx("button",{className:"secondary",onClick:()=>T(s.id,"completed"),children:"Mark complete"}),e.jsx("button",{className:"secondary",onClick:()=>L(s),children:"Print"}),e.jsx("button",{className:"secondary",onClick:()=>_(s.id),children:"Delete"})]})]},s.id))})]})]}):e.jsxs("div",{className:"glass-card fade-in",children:[e.jsx("h2",{style:{margin:0,fontSize:26,fontWeight:800},children:"Authenticate to manage assignments"}),e.jsx("p",{style:{color:"var(--text-muted)"},children:"Assignments and AI blueprints are saved privately to your workspace. No student data leaves your secured scope."})]})}export{ee as default};
